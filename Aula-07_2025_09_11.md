# Banco de dados

## ORM (Object Relational Mapping)

## Criar banco

## Instalar typeORM

`npm install typeorm@0.2.28 --save`

## Instalar o reflect metadata

`npm install reflect-metadata --save`

## Instalar o driver postgresql

`npm install pg --save`

## Adicionar script no package.json

```json
"scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "dev": "ts-node-dev src/server.ts",
    "typeorm": "ts-node-dev ./node_modules/typeorm/cli.js"
},
```

## Criar database no src

```typescript
// database/index.js
import { createConnection } from "typeorm";

createConnection();
```

## Iniciar o typeorm

`npx typeorm init`

## Configurar o typeorm

```json
// ormconfig.json
{
    "type": "postgresql",
    "host": "localhost",
    "port": 5432,
    "username": "postgres",
    "password": "postgres",
    "database": "api",
    "synchronize": true,
    "logging": false,
    "entities": ["src/entity/**/*.ts"],
    "migrations": ["src/database/migration/**/*.ts"],
    "subscribers": ["src/subscriber/**/*.ts"],
    "cli": {
        "entitiesDir": "src/entity",
        "migrationsDir": "src/migration",
        "subscribersDir": "src/subscriber"
    }
}
```

## Mover pasta migration para databse

# Persistir dados

## Criar entidades

```typescript
import { Entity, PrimaryColumn, Column, CreateDateColumn, UpdateDateColumn } from "typeorm";

import { v4 as uuid } from "uuid";

@Entity("users")
export class User {
    @PrimaryColumn()
    readonly id!: string;

    @Column()
    name!: string;

    @Column()
    email!: string;

    @Column()
    admin!: boolean;

    @Column()
    password!: string;

    @CreateDateColumn()
    created_at!: Date;

    @UpdateDateColumn()
    update_at!: Date;

    constructor() {}
}
```

## Adicionar o UUID

`npm install uuid`

## Criar o repository no src

`UserRepository.ts`
